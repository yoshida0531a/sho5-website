<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shogo Photo Gallery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
      background-color: white;
      color: black;
    }

    .top-link {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      color: black;
      text-decoration: none;
    }

    .top-link:hover {
      text-decoration: underline;
    }

    header {
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin: 20px 0;
    }

    .slideshow {
      position: relative;
      width: calc(100% - 20px);
      height: calc(100vh - 507px);
      margin: 0 auto;
      overflow: hidden;
    }

    .slideshow img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      top: 0;
      left: 0;
      border-radius: 10px;
      opacity: 1;
    }

    @media (min-width: 768px) {
      .slideshow {
        height: calc(100vh - 387px);
      }
    }

    .links {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    .links a {
      display: block;
      color: black;
      text-decoration: none;
      font-size: 18px;
      margin: 10px 0;
    }
    .links a:hover {
      text-decoration: underline;
    }

    .loading {
      text-align: center;
      margin: 50px 0;
      font-size: 18px;
    }

    footer {
      text-align: center;
      font-size: 12px;
      margin: 20px 0;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <a href="index.html" class="top-link">←</a>
  <header>Shogo Photo Gallery</header>

  <div class="slideshow">
    <img src="assets/images/flickr_top.JPG" alt="Photo Gallery">
  </div>

  <div class="loading" id="loading">Loading dates...</div>
  <div class="links" id="date-links"></div>

  <footer>Copyright © 2023-2025 Akira Yoshida.</footer>

  <script>
    $(document).ready(function() {
      const correctPassword = "Yakiniku";

      // パスワード入力を促す
      const userPassword = prompt("Please enter Password:");

      if (userPassword === correctPassword) {
        loadDateIndex();
      } else {
        alert("Password is wrong.");
        window.location.href = "https://sho5.org";
      }

      function loadDateIndex() {
        const apiKey = "2a6f3ef0b0db5d5b3f358caf945c106b";
        const userId = "201939165@N04";
        const apiUrl = `https://api.flickr.com/services/rest?api_key=${apiKey}&method=flickr.people.getPublicPhotos&format=json&nojsoncallback=1&extras=date_taken&user_id=${userId}&per_page=500`;

        // Flickr APIからデータを取得
        $.getJSON(apiUrl, function(data) {
          console.log("API Response: ", data);
          if (data.photos && data.photos.photo) {
            let photos = data.photos.photo;
            
            // 撮影日でグループ化
            const dateGroups = {};
            photos.forEach(photo => {
              console.log("Photo data:", photo); // デバッグ用
              if (photo.datetaken) {
                const date = photo.datetaken.split(' ')[0]; // YYYY-MM-DD形式
                console.log("Date found:", date); // デバッグ用
                if (!dateGroups[date]) {
                  dateGroups[date] = 0;
                }
                dateGroups[date]++;
              }
            });
            
            console.log("Date groups:", dateGroups); // デバッグ用

            // 日付を昇順でソート
            const sortedDates = Object.keys(dateGroups).sort();

            let htmlContent = "";
            sortedDates.forEach(date => {
              const photoCount = dateGroups[date];
              htmlContent += `<a href="flickr.html?date=${date}">・${date}</a>`;
            });

            $("#date-links").html(htmlContent);
            $("#loading").hide();
            $("#date-links").show();
          } else {
            console.error("Invalid API Response Structure", data);
            $("#loading").html("<p>日付データが見つかりませんでした。</p>");
          }
        }).fail(function(jqxhr, textStatus, error) {
          console.error("API Call Failed: ", textStatus, error);
          $("#loading").html("<p>日付データを取得できませんでした。</p>");
        });
      }
    });
  </script>
</body>
</html>