# Photo Gallery - 使用ガイド

このガイドでは、新しい画像表示機能と自動アップロード機能の使い方を説明します。

## 📱 画像表示の新機能（flickr-r2.html）

### 基本的な使い方

1. **ギャラリー表示**
   - 画像がグリッド形式で表示されます
   - スクロールすると自動的に追加の画像が読み込まれます

2. **画像の拡大表示**
   - 画像をタップ/クリックすると、ライトボックスで拡大表示されます
   - スマートフォンの画面サイズに最適化されて表示されます

### タッチジェスチャー（スマートフォン）

#### ピンチイン・ピンチアウト
- **操作**: 2本の指で画像を広げる/狭める
- **効果**: 画像を1倍〜5倍まで拡大・縮小
- **用途**: 細部を確認したい時

#### ダブルタップ
- **操作**: 画像を素早く2回タップ
- **効果**: 2倍ズーム ↔ 元のサイズ を切り替え
- **用途**: 素早くズームしたい時

#### スワイプ（左右）
- **操作**: 画面を左右にスワイプ
- **効果**: 前後の画像に移動
- **注意**: ズームしていない時のみ有効
- **用途**: 次の画像を見たい時

#### パン（移動）
- **操作**: ズーム中に指で画面をドラッグ
- **効果**: 拡大された画像の見たい部分に移動
- **用途**: ズーム時の画像移動

### キーボード操作（PC）

- **←キー**: 前の画像に移動
- **→キー**: 次の画像に移動
- **Escキー**: ライトボックスを閉じる

### ナビゲーション

- **閉じるボタン**: 右上の×ボタンでライトボックスを閉じる
- **矢印ボタン**: 左右の矢印ボタンで画像を切り替え
- **画像カウンター**: 上部中央に「現在の画像番号 / 総画像数」を表示
- **背景クリック**: ライトボックスの背景（暗い部分）をクリックで閉じる

### 表示密度の調整

- **+ボタン**: 画像を大きく表示（ギャラリービュー）
- **-ボタン**: 画像を小さく表示（ギャラリービュー）
- 設定は自動的に保存されます

### パフォーマンス機能

- **遅延読み込み**: 画面に表示される画像のみ読み込み
- **プリロード**: 前後の画像を先読みして高速表示
- **キャッシュ**: 一度読み込んだ画像は再利用

## 🔄 自動アップロード機能

### セットアップ

1. **初回セットアップ**
   ```bash
   cd photo-gallery-worker
   ./setup-auto-upload.sh
   ```
   
   - 監視フォルダのパスを入力（Enterでデフォルト）
   - 自動的にフォルダと設定ファイルが作成されます

2. **環境変数で設定**（オプション）
   ```bash
   # .envファイルを編集
   nano .env
   ```

### 使い方

1. **自動アップロードを開始**
   ```bash
   cd photo-gallery-worker
   npm run auto-upload
   ```

2. **写真をコピー**
   - 監視フォルダに写真ファイルをコピー
   - デフォルト: `/Users/akira/Pictures/shogo写真データ/auto-upload`

3. **自動処理**
   - ファイルを検出
   - 自動的にリサイズ（最大2400px）
   - EXIF情報から撮影日時を取得
   - Cloudflare R2にアップロード
   - 処理済みフォルダに移動

4. **停止**
   - `Ctrl+C` で停止

### 処理の流れ

```
写真をコピー
    ↓
自動検出
    ↓
リサイズ（2400px以下に圧縮）
    ↓
EXIF情報取得（撮影日時）
    ↓
R2にアップロード（日付フォルダに分類）
    ↓
処理済みフォルダに移動
```

### フォルダ構造

```
auto-upload/              # 監視フォルダ
├── IMG_001.JPG          # 処理待ち
├── IMG_002.JPG          # 処理待ち
└── processed/           # 処理済みフォルダ
    ├── IMG_000.JPG      # アップロード済み
    └── IMG_999.JPG      # アップロード済み
```

### 対応フォーマット

- JPG / JPEG
- PNG

### 注意事項

1. **容量制限**
   - Cloudflare R2無料枠: 10GB/月
   - 1枚約500KB（圧縮後）
   - 約20,000枚保存可能

2. **処理速度**
   - 1枚あたり数秒程度
   - 大量の写真は時間がかかります

3. **エラーハンドリング**
   - EXIF情報がない場合: ファイル日時を使用
   - アップロード失敗: エラーログを表示

## ❓ トラブルシューティング

### 画像が拡大できない

- ブラウザのキャッシュをクリア
- JavaScriptコンソールでエラーを確認
- タッチスクリーン対応デバイスで確認

### スワイプが効かない

- ズームしていないか確認
- 横方向にスワイプしているか確認
- 他のジェスチャー（縦スクロール）と混同していないか確認

### 自動アップロードが動作しない

1. **依存関係の確認**
   ```bash
   node --version
   wrangler --version
   ```

2. **監視フォルダの確認**
   - フォルダが存在するか
   - 書き込み権限があるか

3. **macOS以外の場合**
   - ImageMagickなどのインストールが必要
   - `auto-upload.js` のリサイズコマンドを変更

### EXIF読み取りエラー

- 一部のファイルはEXIF情報がない場合があります
- その場合はファイル日時が使用されます
- スクリーンショットなどはEXIF情報がありません

## 📞 サポート

問題が解決しない場合は、以下の情報を含めて報告してください：

- エラーメッセージ
- 使用しているOS
- ブラウザ/デバイス情報
- 再現手順

## 🔒 セキュリティ

- パスワード認証はセッション単位で保持
- 画像はCloudflare R2に安全に保存
- APIエンドポイントはCORS設定済み
